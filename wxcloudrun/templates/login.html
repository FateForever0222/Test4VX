<script>

  function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return pair[1];
            }
        }
        return (false);
    }
  myUrlLocation=window.location['host']
  console.log(myUrlLocation)
  window.onload=function(){
    if (window.location.search.indexOf('code=')==-1){
      const baseurl='https://open.weixin.qq.com/connect/oauth2/authorize'
      const redirect_uri=window.location.href
      const state='1234'
      const appid='wx264ea0f7e61d1723'
      window.location.href= `${baseurl}?appid=${appid}&redirect_uri=${redirect_uri}&response_type=code&scope=snsapi_base&state=${state}#wechat_redirect`
    }
  
  if(getQueryVariable('code')){
    var code= getQueryVariable('code')
    const appid='wx264ea0f7e61d1723'
    const secret="0627dc277cfe7f3bd883a0d0ad4c3aec"
    const baseurl_getopenid ="https://api.weixin.qq.com/sns/oauth2/access_token"
    var url= `${baseurl_getopenid}?appid=${appid}&secret=${secret}&code=${code}&grant_type=authorization_code`
    console.log(myUrlLocation+"/getOpenid?url=\'"+url+"\'")
    window.location.href=("/getOpenid?url='"+url+"'")
  }
  
}
  
</script>
